/**handles:html-to-image**/
jQuery(document).ready(function(c){var e=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./),s=e?parseInt(e[1]):0,l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);const{__:p,_x:t,_n:n,_nx:o}=wp.i18n;c("body").append('<svg id="tutor_svg_font_id" width="0" height="0" style="background-color:white;"></svg>');const u=(e,r)=>{const t=new XMLHttpRequest;t.open("get","?tutor_action=get_fonts&course_id="+e),t.responseType="text",t.send(),t.onloadend=()=>{let o=t.response;const a=o.match(/https?:\/\/[^ \)]+/g);let i=0;a.forEach(t=>{const n=new XMLHttpRequest;n.open("get",t),n.responseType="blob",n.onloadend=()=>{const e=new FileReader;e.onloadend=()=>{o=o.replace(new RegExp(t),e.result),i++,i==a.length&&(c("#tutor_svg_font_id").prepend(`<style>${o}</style>`),r())},e.readAsDataURL(n.response)},n.send()})}};var a=function(r,d,t){this.view=e=>{window.location.assign(t)},this.download=(e,t,n)=>{var o=new window.jsPDF(n<t?"l":"p","px",[t,n]);o.addImage(e,"jpeg",0,0,t-.249*t,n-.249*n),o.save("certificate-"+(new Date).getTime()+".pdf")},this.reload=function(){window.location.reload()},this.dataURItoBlob=(e,t)=>{for(var n=atob(e.split(",")[1]),e=new ArrayBuffer(n.length),o=new Uint8Array(e),a=0;a<n.length;a++)o[a]=n.charCodeAt(a);return new Blob([e],{type:t})},this.store_certificate=(e,n)=>{var t=tutor_get_nonce_data(!0),o=new FormData;o.append("action","tutor_store_certificate_image"),o.append("cert_hash",d),o.append("certificate_image",this.dataURItoBlob(e,"image/jpeg"),"certificate.jpg"),o.append(t.key,t.value),c.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:o,processData:!1,contentType:!1,success:function(e){var t=(e.data||{}).message;n(e&&e.success,t)},error:function(){n(!1)}})},this.dispatch_conversion_methods=(a,e,i)=>{var t=e.getElementsByTagName("body")[0],n=e.getElementById("watermark"),o=n.offsetWidth,n=n.offsetHeight;t.style.display="inline-block",t.style.overflow="hidden",t.style.width=o+"px",t.style.height=n+"px",t.style.padding="0px",t.style.margin="0px";var e=e.getElementsByTagName("body")[0],r;html2canvas(e,{scale:3,letterRendering:!0,allowTaint:!0,useCORS:!0,x:0,y:0,width:o,height:n,windowWidth:o,windowHeight:n}).then(n=>{var o=n.toDataURL("image/jpeg",1);this.store_certificate(o,(e,t)=>{e||alert(t||p("Something Went Wrong","tutor-pro")),e&&"function"==typeof this[a]&&this[a](o,n.width,n.height),"function"==typeof i&&i(e)})})},this.init_render_certificate=(a,i)=>{var e;c.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:{action:"tutor_generate_course_certificate",course_id:r,certificate_hash:d||""},success:e=>{var n=e.success?e.data.html:"",t=document.createElement("iframe"),o=function(e){var t;e.write(n),e.write(c("<div></div>").append(c("#tutor_svg_font_id").clone()).html()),s&&((t=window.document.createElement("style")).innerHTML="*{word-spacing:3px !important; letter-spacing:2px !important;}",e.getElementsByTagName("head")[0].appendChild(t))};s||l?t.addEventListener("load",()=>{var e,e=(e=t.contentWindow||t.contentDocument.document||t.contentDocument).document;o(e),u(r,()=>this.dispatch_conversion_methods(a,e,i))}):u(r,()=>{var e=t.contentWindow||t.contentDocument.document||t.contentDocument,e;(e=e.document).open(),o(e),e.close(),t.onload=()=>this.dispatch_conversion_methods(a,e,i)}),t.style.position="absolute",t.style.left="-999999px",document.getElementsByTagName("body")[0].appendChild(t)}})}},i=c("#tutor-download-certificate-pdf"),r=c("#tutor-pro-certificate-download-pdf"),d=0<i.length?i:r,h=c('<img class="tutor_progress_spinner" style="display:inline;margin-left:5px" src="'+window._tutorobject.loading_icon_url+'"/>'),e=c("#tutor-view-certificate-image"),g,w,f,m=new a(d.data("course_id"),d.data("cert_hash"),e.data("href"));i.add(e).add(r).click(function(e){e.preventDefault(),0==c(this).find(".tutor_progress_spinner").length&&c(this).append(h);var e="tutor-view-certificate-image"==c(this).attr("id")?"view":"download";m.init_render_certificate(e,()=>{c(this).find(".tutor_progress_spinner").remove()})});var r=c("#tutor-pro-certificate-download-image");r.click(function(){var e=c("#tutor-pro-certificate-preview"),t=document.createElement("A");t.href=e.attr("src"),t.download="certificate-"+(new Date).getTime()+".jpg",document.body.appendChild(t),t.click(),document.body.removeChild(t)}),0<r.length&&"no"==c("#tutor-pro-certificate-preview").data("is_generated")&&m.init_render_certificate("",function(){window.location.reload()})});